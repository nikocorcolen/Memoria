
%% inicio, la clase del documento es iccmemoria.cls
\documentclass{iccmemoria}
%% datos generales y para la tapa
\titulo{Dispositivo de riego inteligente de bajo costo para el uso eficiente del agua}
\author{Nicolás Gastón Maturana Barrios}
\supervisor{Benjamín Ingram}
\informantes
	{Profesor Informante 1}
	{Profesor Informante 2}
\adicional{(sólo por si se necesita agregar algún otro profesor)}
\director{Profesor del ramo Memoria de Título}
\date{Diciembre, 2015}

%% inicio de documento
\begin{document}

%% crea la tapa
\maketitle

%% dedicatoria
\begin{dedicatory}
Dedicado a ...
\end{dedicatory}

%% agradecimientos
\begin{acknowledgment}
Agradecimientos a ...
\end{acknowledgment}

%% indices
\tableofcontents
\listoffigures
\listoftables

%% resumen
\begin{resumen}
Aquí va el resumen (en Castellano)... 
\end{resumen}

%% abstract

%% contenido del primer capítulo
\chapter{Introducción}
\section{Descripción de la propuesta}
\subsection{Contexto del proyecto}
El proyecto consiste en desarrollar un sistema de riego autónomo e inteligente ideal para las personas que viajan mucho y les gusta mantener sus jardines en buen estado. Lo que se busca es reducir la intervención humana, aumentar la eficiencia en el uso del agua, ahorrar dinero y entregar datos estadísticos a los usuarios. El sistema básicamente cociste en sensores de humedad del suelo, un micro computador y válvulas. Cuando un sensor detecte que la humedad del suelo no es la adecuada para mantener el césped en buen estado, le envía una señal a la raspberry la que a su vez analiza datos meteorológicos y decide si es necesario o no hacer un riego. Con todo esto, se asegura que el jardín se encuentre en buen estado utilizando la menor cantidad de agua posible.

Para el proyecto se utiliza un micro computador el cual se programa en Python, y es el encargado de recibir los datos de entradas, que en este caso son los datos meteorológicos y los del sensor de humedad. Una vez que los datos son recibidos el micro computador los analiza y si se requiere un riego envía una señal la válvula solenoide que permitirá el paso del agua. También se utilizará un sensor de flujo para medir la cantidad de agua que se esta utilizando y así entregar reportes al usuario.

Cabe destacar que este sistema no solo es útil para los jardines, sino que también se puede utilizar para los huertos y/o predios agrícolas que utilizan sistemas de riego automáticos.

\subsection{Trabajo relacionado}
Los trabajos que hoy en día son utilizados para resolver este problema cumplen su propósito general, que es el de automatizar el riego, pero en esta solución aun se requiere la intervención de las personas para su funcionamiento, como lo son los sistemas que utilizan temporizadores~\cite{temporizador}. Estos dispositivos, se activan cada cierto intervalo de tiempo sin tomar en cuenta variables importantes como lo son la humedad del suelo. También existen trabajos en los que se mide la humedad del suelo~\cite{temporizadorSensorHumedad} pero aun no se logra darle al agua de riego el uso óptimo, ya que no toma en cuenta los datos meteorológicos y en caso que se aproxime una lluvia el sistema igual hará el riego.

En el mercado tenemos la opción de adquirir estos dispositivos para automatizar nuestro riego pero son soluciones que tienen un costo muy elevado. Estos dispositivos se pueden encontrar en las tiendas de retail.

Por otro lado tampoco indican el consumo de agua que se ha utilizado en el riego y tampoco tienen sistema de prevención en caso de condiciones climáticas extremas, como puede ser el frío extremo que nos ayuden a mantener en buen estado nuestro jardín.

\subsection{Definición del problema}
A muchas personas les gusta mantener un jardín verde, pero generalmente no tienen el tiempo para regar y mantener su jardín como les gustaría. Por otro lado tenemos todos los problemas que genera el cambio climático, como lo son las temperaturas extremas y siendo uno de los principales afectados los recursos hídricos~\cite{cambioClimatico}, por otro lado, el método más utilizado es el riego por surcos~\cite{surcos}. Con la implementación de este proyecto, se busca que la mantención del jardín de un hogar sea de una forma autónoma e inteligente, es decir, que no necesite la intervención de personas para su funcionamiento y que en lo posible no utilice mas agua de la debida.

Otro problema es el causado por las temperaturas extremas, que pueden producir mucho daño en el jardín, llegando a extremos en el que se pierde todo. Pero ¿Cuánta agua he utilizado? ¿Cuánto dinero  he gastado en el agua para riego? ¿Qué cantidad de riegos ha tenido mi jardín? son preguntas que las personas se hacen y no tienen respuesta.

\subsection{Propuesta de solución}
Como solución al problema, se creara un prototipo de riego automático e inteligente. Esto se hará utilizando un micro computador y sensores de humedad. Lo distinto que tendrá este sistema de otros, es que para determinar si se debe hacer un riego o no, tomará en cuenta datos meteorológicos obtenidos desde Internet, y en caso de que se pronostique una lluvia, no se hará el riego. El sistema contara con un GPS para determinar la posición en la que se encuentra el jardín a regar y obtener los datos de lluvia. También contará con un sistema preventivo que ayude al cuidado del jardín, por ejemplo cuando se detecte que habrá una helada y ésta puede producir algún tipo daño, el sistema podrá enviar un mensaje al usuario o podrá activar el sistema de riego para así prevenir daños.

El sistema almacenará toda la información recopilada por los sensores guardándola en un único servidor, con lo que los usuarios utilizando un usuario y una contraseña podrán consultar los datos estadísticos a través de una aplicación web o una móvil. Este servidor que tendrá la base de datos, también será utilizado en caso que de el micro computador deje de funcionar, ya que éste estará constante mente enviando una señal al servidor para saber si el sistema esta funcionando o no, para así informar a los usuarios de que el sistema esta fallando, asegurando un funcionamiento a lo largo del tiempo.

Con toda la información que el sistema recibe como entrada, será utilizada para generar un modelo de riego con el que se espera darle una mayor eficiencia al agua que es utilizada en el riego.

Todo esto hará que el sistema sea inteligente al momento de generar un riego, sacando totalmente a las personas de esta tarea, además entregando información que le puede ser útil a los usuarios.


\section{Hipótesis}
\begin{itemize}
\item El prototipo es realizable con la tecnología existente.
\item Las personas dejarán de preocuparse por el riego de su jardín.
\item El uso de este sistema cuidará el jardín en todas las estaciones del año.
\item La utilización del modelo de riego disminuirá el consumo de agua.
\end{itemize}

\section{Objetivos}
\paragraph{Objetivo general}
\begin{itemize}
\item El objetivo es diseñar un dispositivo inteligente de bajo costo que será utilizado en los jardines para automatizar y monitorear el riego.
\end{itemize}

\paragraph{Objetivos específicos}
\begin{itemize}
\item Diseñar un prototipo del dispositivo (Hardware).
\item Diseñar un modelo para el riego (Software).
\item Diseñar un prototipo de aplicación web y/o móvil para los usuarios.
\item Implementar un sistema de alertas para condiciones climáticas extremas.
\end{itemize}

\section{Alcances}
\begin{itemize}
\item El sistema de riego (cañerías, aspersores, etc.) debe estar previamente instalado.
\item El modelo de riego será básico y se podrá mejorar con más tiempo y personas especializadas en riego.
\item En el monitoreo los usuario podrán ver la humedad y la cantidad de agua utilizada en el riego.
\item Se diseñará una aplicación web y/o móvil que permita a los usuarios visualizar la humedad del suelo y la cantidad de agua utilizada, y además tendrá la funciona de activar y desactivar el riego.
\end{itemize}

\section{Metodología}

\paragraph{Objetivo 1:} ``Diseñar un prototipo del dispositivo (Hardware)"\\
\begin{itemize}
\item Determinar las piezas necesarias para construir el dispositivo.
\item Leer documentación de las piezas.
\item Juntar todas las partes para formar el dispositivo.
\item Probar el dispositivo armado.
\end{itemize}

\paragraph{Objetivo 2:} ``Diseñar un modelo para el riego (Software)"\\
\begin{itemize}
\item Determinar las variables que se utilizarán.
\item Desarrollo del modelo (Desarrollo de software).
\item Probar el modelo en el dispositivo.
\end{itemize}

\paragraph{Objetivo 3:} ``Diseñar un prototipo de aplicación web y/o móvil para los usuarios"\\
\begin{itemize}
\item Diseñar mockup de aplicación web y/o móvil.
\item Desarrollo de la aplicación.
\item Pruebas de la aplicación.
\end{itemize}

\paragraph{Objetivo 4:} ``Implementar un sistema de alertas para condiciones climáticas extremas"\\
\begin{itemize}
\item Determinar y analizar las variables que son utilizadas para predecir una helada.
\item Implementar un sistema de notificación para los usuarios.
\end{itemize}

%% contenido del segundo capítulo
\chapter{Marco teórico}

\section{Programación del riego}

La programación del riego, es la planificación de cuándo y qué cantidad de agua aplicar con el fin de mantener el crecimiento saludable de las plantas durante la estación de crecimiento. Es una práctica de gestión diaria esencial.

El momento adecuado del riego es una decisión crucial para la aplicación: 
\begin{itemize}
\item Satisfacer las necesidades de agua del cultivo para evitar la pérdida de rendimiento debido a la escasez de agua.
\item Maximizar la eficiencia del uso del agua de riego y conservar los recursos hídricos locales.
\end{itemize}

Un riego eficaz sólo es posible con un seguimiento periódico de las condiciones del agua del suelo y el desarrollo de lo que se esta cuidando (campos de cultivos o jardines) y con la previsión de las futuras necesidades de agua. Retrasar el riego hasta provoca estrés, o aplicar muy poca agua puede resultar en una pérdida sustancial. La aplicación de mucha agua se traducirá en costes adicionales y agua desperdiciada.

Existen varias herramientas que están disponibles para ayudar a un administrador el riego: sondas de suelo, sensores de humedad del suelo, estaciones meteorológicas, etc.

Para la programación del riego se utilizarán sensores de humedad del suelo y datos obtenidos de alguna estación meteorológica que entregará la probabilidad de lluvia en el lugar, cuando sea posible y a causa de que existe probabilidad de lluvia, la cantidad de agua de riego aplicada debe ser algo menor que el déficit de agua en el suelo con el fin de proporcionar el resto con la lluvia que caerá en el lugar.

Ora variable que se tendrá en cuenta, es el tipo de suelo en el que se encuentra ubicado el sistema de riego, ya que permitirá saber la capacidad de absorción  que éste tiene, con el conocimiento de esta información se podrá saber cuándo comenzar un riego con el fin de utilizar el agua de forma eficiente.


\subsection{Textura del suelo}

La textura indica el contenido relativo de partículas de diferente tamaño, como la arena, el limo y la arcilla, en el suelo. La textura tiene que ver con la facilidad con que se puede trabajar el suelo, la cantidad de agua y aire que retiene y la velocidad con que el agua penetra en el suelo y lo atraviesa.

Para conocer la textura de una muestra de suelo~\cite{sueloTextura}:
\begin{itemize}
\item Arcilloso: Se adhiere bastante, es fácilmente moldeable, las partículas no son visibles y la superficie brilla levemente.
\item Limoso: Se adhiere a los dedos, se moldea con dificultad, los dedos dan apariencia grasosa y las partículas son brillantes.
\item Arenoso: No se pega en los dedos, no se moldea como una masa y sus partículas individuales son visibles.
\end{itemize}

Cada uno de estos tipos de suelos presentan una propiedad llamada permeabilidad; que es la característica que tiene el suelo de transmitir el agua y el aire y es una de las cualidades más importantes que han de considerarse a la hora de realizar un riego. Mientras más permeable sea el suelo, mayor sera la filtración.

Por regla general, como se muestra en la Figura \ref{permeabilidad}, mientras más fina sea la textura del suelo, más lenta sera la permeabilidad:

\begin{figure}[h]
	\begin{center}
		\includegraphics[width=6cm]{permeabilidad.PNG}
	\end{center}
	\caption{Permeabilidad según textura del suelo}
	\label{permeabilidad}
\end{figure}

\section{Servicios web meteorológicos}
\subsection{¿Qué es un servicio web?}
Los servicios web son sistemas de software que permiten el intercambio de datos y funcionalidad entre aplicaciones sobre una red. Esta soportado en diferentes 
estándares que garantizan la interoperabilidad de los servicios~\cite{webService}.

En la Figura \ref{rest}, se puede apreciar la arquitectura de un servicio web, se ve que el cliente realiza un petición al servidor y éste le envía una respuesta con lo solicitado.

\begin{figure}[h]
\centering
\includegraphics[width=5cm]{rest.jpg}
\caption{Arquitectura servicio web}
\label{rest}
\end{figure}

Un servicio web REST, es un servicio implementado usando HTTP y que entrega como resultado un XML o un JSON de los cuales se puede obtener la información solicitada.

\subsection{Wunderground}
Weather Underground es un servicio que entrega información meteorológica que ha desafiado las convenciones en torno a cómo la información del tiempo se comparte con el público desde 1993. Se ha creado con el fin de mejorar el acceso de las personas a los datos meteorológicos significativos de todo el mundo. Como servicio meteorológico primero de Internet, son considerados pioneros en su campo y están en constante búsqueda de nuevos conjuntos de datos y tecnologías que ayuden a compartir más datos con más gente.

Wunderground no da la posibilidad de consultar el clima dado las coordenadas de la posición en la que un punto se encuentra, estas coordenadas pueden ser obtenidas de forma automática utilizando un GPS o ingresándolas manualmente. Para utilizar el servicio, es necesario registrarse para obtener un llave que se utiliza para realizar las consultas meteorológicas.

Para obtener más información y/o registrarse para utilizar el servicio se puede hacer en la siguiente url: 

\url{http://www.wunderground.com/weather/api/d/docs?d=index}\\

La estructura de la url para realizar la consulta de la siguiente:

\url{http://api.wunderground.com/api/e7d949410a7481dc/forecast10day/lang:SP/q/-34.40819094134256,-71.00087251514196.json}

\begin{itemize}
\item \url{http://api.wunderground.com/api/} es la dirección donde se hace la consulta.
\item \url{e7d949410a7481dc} es la llave que se obtiene al registrarse.
\item \url{forecast10day} retorna datos meteorológicos de los siguientes 10 días.
\item \url{lang:SP} se utiliza para obtener los datos en español.
\item \url{q/-34.40819094134256,-71.00087251514196} son las coordenadas del lugar que se quieren obtener los datos.
\item \url{.json} es el formato en el que se devuelve la información, también puede ser .xml.
\end{itemize}

Los datas obtenidos se pueden apreciar en la Figura \ref{response}:

\begin{figure}[h]
\centering
\includegraphics[width=10cm]{response.png}
\caption{Respuesta del servicio wunderground al hacer una consulta}
\label{response}
\end{figure}

\newpage

De toda la información que entrega el servicio web wunderground, lo único que nos interesa hasta el momento, es el campo pop, que significa probabilidad de precipitación, que esta representada en porcentaje.

\section{Trabajos relacionados}

\subsection{Cultivar}
Cultivar está desarrollando y fabricando por Raincloud~\cite{raincloud}. Raincloud administra de forma conveniente e inteligente la gestión del agua, con un sistema de riego conectado a la web que permite monitorear en todo momento es estado del sistema. Raincloud vincula los dispositivos móviles permitiendo activar válvulas de agua y consultar sensores de humedad utilizando Wi-Fi.\\

Ventajas:
\begin{itemize}
\item Utiliza sensores de humedad de suelo.
\item Se controla a través de un teléfono móvil.
\item Consume la menor cantidad de agua posible.
\item Almacena los datos en la nube.
\item Entrega estadísticas del consumo de agua.
\end{itemize}

Desventajas:
\begin{itemize}
\item Necesita configuración previa.
\item Se necesita Wi-Fi en el hogar para su óptimo funcionamiento.
\item Tiene un costo muy elevado. \$500 dolares.
\item No toma en cuenta datos meteorológicos.
\end{itemize}

\subsection{Rachio IRO}
Iro~\cite{rachio} es un controlador de riego inteligente que permite a las personas de manera fácil, mantener sus jardines en buen estado. Se integra de manera fácil al Wi-Fi de su hogar, entregando un completo control a través de su computador o teléfono móvil.

Rachio se ajusta automáticamente a los datos meteorológicos del lugar en el que se encuentra, estación del año, tipo de zona y características de la región.\\

Ventajas:
\begin{itemize}
\item Se controla a través de un teléfono móvil o una computador.
\item Puede funcionar de forma automática. 
\item Se ajustara automáticamente a el clima.
\item Consume la menor cantidad de agua posible.
\item No necesita programarse.
\item Entrega estadísticas del consumo de agua.
\end{itemize}

Desventajas:
\begin{itemize}
\item No utiliza sensores de humedad de suelo.
\item Se necesita Wi-Fi en el hogar para su óptimo funcionamiento.
\item Tiene un costo muy elevado. \$249 / \$299 dolares.
\end{itemize}

\section{Hardware}
Todas las partes físicas de un sistema que tiene componentes: eléctricos, electrónicos, electromecánicos y mecánicos. Para la construcción del sistema de riego se necesitarán una serie de componentes, sensores, actuadores y computadores para su correcto funcionamiento.

\subsection{Raspberry pi}
El Raspberry Pi~\cite{raspberry} es un microcomputador del tamaño de una tarjeta de crédito a bajo costo que se conecta a un monitor o un televisor, utiliza un teclado y un ratón estándar. Es un dispositivo que permite a las personas de todas las edades explorar la computación y aprender a programar en lenguajes como Python. Es capaz de hacer todo lo que espera de una computadora de escritorio, desde navegar por Internet y reproducir vídeos en alta definición, trabajar en hojas de cálculo, procesadores de texto, y jugar juegos.

Raspberry Pi tiene la capacidad de interactuar con el mundo exterior, y se ha utilizado en una amplia gama de proyectos digitales, máquinas de música y detectores en las estaciones meteorológicas.

\begin{figure}[h]
\centering
\includegraphics[width=5cm]{rasp.png}
\caption{Raspberry Pi modelo B+}
\label{rasp}
\end{figure}

\subsection{Arduino}
Arduino~\cite{arduiino} es una plataforma de prototipos electrónica de código abierto (open-source) basada en hardware y software flexibles y fáciles de usar. Está pensado para artistas, diseñadores, como hobby y para cualquiera interesado en crear objetos o entornos interactivos.
Arduino puede sentir el entorno mediante la recepción de entradas desde una variedad de sensores y puede afectar a su alrededor mediante el control de luces, motores y otros artefactos. 

\begin{figure}[h]
\centering
\includegraphics[width=5cm]{arduino.png}
\caption{Arduino}
\label{arduino}
\end{figure}


\subsection{Servidor de base de datos}
Un servidor de bases de datos se utiliza para almacenar, recuperar y administrar los datos de una base de datos. El servidor gestiona las actualizaciones de datos, permite el acceso simultáneo de muchos servidores o usuarios web y garantiza la seguridad y la integridad de los datos. Y cuando hablamos de datos, podemos estar hablando sobre millones de elementos a los que acceden al mismo tiempo miles de usuarios.

Así como sus funciones básicas, el software de servidores de bases de datos ofrece herramientas para facilitar y acelerar la administración de bases de datos. Algunas funciones son la exportación de datos, la configuración del acceso de los usuarios y el respaldo de datos.

\subsection{Servidor web}
Básicamente, un servidor web sirve contenido estático a un navegador, carga un archivo y lo sirve a través de la red al navegador de un usuario. Este intercambio es mediado por el navegador y el servidor que hablan el uno con el otro mediante HTTP.

\subsection{Sensores de humedad}
Un sensor de resistencia eléctrica~\cite{sensor}, estima indirectamente la tensión del suelo mediante la medición de la resistencia eléctrica utilizando alambre que va en un bloque de un material especial que mantiene su contenido de humedad en equilibrio con el suelo. La resistencia eléctrica dentro del bloque varía con el contenido de agua del suelo. 
Estos requieren poca preparación antes de la instalación y no requieren mantenimiento durante la temporada.

\begin{figure}[h]
\centering
\includegraphics[width=5cm]{sensorHumedad.jpg}
\caption{Sensor de humedad}
\label{snsorHumedad}
\end{figure}


\subsection{Sensor de flujo de agua}
El sensor de flujo de agua consiste en una válvula de cuerpo plástico, un rotor de agua y un sensor de efecto hall. Cuando el agua fluye a través del rotor, el rotor gira. Su velocidad cambia con diferentes ritmos de flujo. El sensor de efecto hall tiene como salida la señal de pulso correspondiente.

\begin{figure}[h]
\centering
\includegraphics[bb=0 0 640 480, width=5cm]{sensorFlujo.jpg}
\caption{Sensor de flujo de agua}
\label{sensorFlujo}
\end{figure}

\subsection{Válvula solenoide}
Una válvula solenoide esta diseñada para controlar el paso de un fluido por un conducto o tubería. La válvula se mueve mediante una bobina solenoide. Generalmente no tiene más que dos posiciones: abierto y cerrado, o todo y nada. Las electroválvulas se usan en multitud de aplicaciones para controlar el flujo de todo tipo de fluidos.

\begin{figure}[h]
\centering
\includegraphics[width=5cm]{valvulasolenoide.jpg}
\caption{Válvula solenoide}
\label{valvulasolenoide}
\end{figure}

\subsection{GPS}
GPS~\cite{gps} es un sistema que tiene como objetivo la determinación de las coordenadas espaciales de puntos respecto de un sistema de referencia mundial. Los puntos pueden estar ubicados en cualquier lugar del planeta, pueden permanecer estáticos o en movimiento y las observaciones pueden realizarse en cualquier momento del día. Para la obtención de coordenadas el sistema se basa en la determinación simultánea de las distancias a cuatro satélites (como mínimo) de coordenadas conocidas. Estas distancias se obtienen a partir de las señales emitidas por los satélites, las que son recibidas por receptores especialmente diseñados. Las coordenadas de los satélites son provistas al receptor por el sistema. 

\begin{figure}[h]
\centering
\includegraphics[width=5cm]{gps.jpg}
\caption{Módulo GPS USB}
\label{gps}
\end{figure}

\subsection{Módem 3G}
Módem 3G es un terminal de red inalámbrica basada en la tecnología CDMA2000. Es la mejor opción para los usuarios que necesiten acceder a Internet desde cualquier lugar en cualquier momento. El módem está conectado al micro computador mediante una interfaz USB.

\begin{figure}[h]
\centering
\includegraphics[width=4cm]{modem.jpg}
\caption{Módem 3G}
\label{modem}
\end{figure}

\subsection{Cargador}
Un cargador es un dispositivo utilizado para suministrar corriente eléctrica a un dispositivo, que en este caso se tratará de la Raspberry Pi. El cargador debe funcionar a 5V y entregar una corriente de 700mA.

\begin{figure}[h]
\centering
\includegraphics[width=4cm]{cargador.jpg}
\caption{Cargador}
\label{cargador}
\end{figure}



\section{Software}
\subsection{Raspbian}
Raspbian~\cite{raspbian} es un sistema operativo libre basado en Debían optimizado para el hardware Raspberry Pi. Un sistema operativo es el conjunto de programas básicos y utilidades que hacen que Raspberry Pi funcione. Sin embargo, Raspbian ofrece más que un sistema operativo; viene con más de 35.000 paquetes, software pre-compilado en un formato que hace más fácil la instalación en su Raspberry Pi.

Raspbian no tiene relación con la Fundación Raspberry Pi. Raspbian fue creado por un pequeño y dedicado equipo de desarrolladores que son fans del hardware Raspberry Pi.

Instalador: "\url{https://www.raspbian.org/RaspbianInstaller}"

\subsection{Python}
Python es un claro  y poderoso lenguaje de programación orientado a objetos, comparable con Perl, Ruby o Java.

Algunas de las características de Python son:

\begin{itemize}
\item Python ideal para el desarrollo de prototipos y otras tareas de programación, sin comprometer la capacidad de mantenimiento.
\item Utiliza una sintaxis clara, por lo que los programas son fáciles de leer.
\item Viene con una biblioteca estándar que soporta muchas tareas comunes de programación, tales como la conexión a los servidores web, la búsqueda de texto con expresiones regulares, leer y modificar archivos.
\item Es software libre. No cuesta nada descargar o utilizar Python.
\item Tiene librerías que facilitan el uso de la interfaz GPIO de la Raspberry Pi.
\end{itemize}

\url{https://wiki.python.org/moin/BeginnersGuide/Overview}

\subsubsection{Librería GPIO}
Una de las características de gran alcance de la Raspberry Pi es la fila de GPIO~\cite{gpio} (Entrada/Salida de Propósito General) alfileres a lo largo del borde de la placa, junto a la salida de vídeo socket amarilla como se puede apreciar en la Figura \ref{gpio}:

\begin{figure}[h]
\centering
\includegraphics[width=7cm]{gpio.jpg}
\caption{GPIO Raspberry Pi}
\label{gpio}
\end{figure}

Estos pines son una interfaz física entre el la Raspberry y el mundo exterior. Al nivel más simple, se puede pensar en ellos como interruptores que puede activar o desactivar ya sean las entradas como las salidas. Diecisiete de los veinte y seis pines son GPIO; los otros son pines de alimentación o de tierra como se ve en la Figura \ref{giop1}:

\begin{figure}[h]
\centering
\includegraphics[width=7cm]{giop1.png}
\caption{Pines GPIO}
\label{giop1}
\end{figure}

¿Qué puedo hacer con esto?\\

Puede programar los pines de maneras asombrosas para interactuar con el mundo real. Las entradas no tienen que venir de un interruptor físico; podría ser la entrada de un sensor o una señal de otro ordenador o dispositivo, por ejemplo. La salida también puede hacer cualquier cosa, desde encender un LED con el envío de una señal o de datos a otro dispositivo. Si la Raspberry está en una red, puede controlar los dispositivos que están conectados a él desde cualquier lugar. Conectividad y control de los dispositivos físicos a través de Internet es algo muy poderoso y emocionante, y la Raspberry es ideal para esto.

%% contenido del tercer capítulo
\chapter{Análisis del problema}

El presente capítulo tiene por objetivo dar a conocer la problemática existente relacionada a la mantención de césped, mencionando también los métodos utilizados, los problemas que estos tienen y mostrar un prototipo de como solucionar uno los problemas que se mencionarán.

\section{Descripción del problema}

La mantención de jardines y áreas verdes es una actividad muy común hoy en día en Chile, más aún cuando existen propuestas  del propio estado de Chile por promover esta iniciativa, aumentando la inversión y ampliando cada vez más los parques en diferentes comunas de Chile.

Estas áreas verdes no requieren de mucho cuidado, principalmente se necesita cortar y regar el césped que es en la actividad que estamos enfocados, entonces ¿Cómo se riega el césped hoy en día en nuestro país? principalmente se utilizan dos métodos:

\begin{itemize}
\item Riego manual: la persona encargada del riego, riega hasta que considere que el césped se encuentra lo suficientemente húmedo.
\item Riego por aspersores: generalmente funcionan automáticamente todos los días durante un periodo de tiempo determinado.
\end{itemize}

Ambos métodos utilizan en exceso el agua, además a esto le sumamos que por lo general se utiliza agua potable, se traduce en un gran desperdicio y más aún cuando existe escasez de agua en el país.

El año 2013 fue uno de los años más secos desde 1866. Existen déficit de precipitaciones que van desde un 20\% llegando incluso hasta un 60\% entre las zonas de Copiapó y Talca al sur, estas son zonas de gran producción agrícola y además entre los lugares mencionados son los que han tenido mayor inversión para poder satisfacer la demanda de agua dulce a las personas~\cite{sequia}. 

Los dispositivos utilizados hoy en día no consideran el tipo de suelo en el cual se realizará el riego, esto es importante porque cada suelo tiene una capacidad de absorción distinta. Esta información es importante porque al no aplicar la cantidad justa de agua, se daña el suelo como por ejemplo la erosión~\cite{erosion}, además del agua desperdiciada.

Es por ello, que es muy importante y de suma urgencia idear nuevas técnicas de riego sustentables en las que se obtenga el mayor provecho del agua que permita mantener el nivel de producción agrícola en Chile o incluso aumentarlo.


\section{Problemas identificados}

Según Chuck Ingels~\cite{problemas}, asesor agrícola de Extensión Cooperativa de la Universidad de California en el condado de Sacramento y Loren Oki, especialista de Extensión Cooperativa en el Departamento de Botánica de UC Davis y especialista en horticultura de paisajes, existen problemas en los sistemas de riego actuales que hoy en día son utilizados, ellos nombran principalmente cuatro problemas: 

\begin{itemize}
\item ``Apagar el sistema de riego por aspersores después de que llueve es el primer paso que se debe tomar para ahorrar agua"
\item ``El riego de césped y jardines representa más de la mitad del agua usada en un hogar promedio"
\item ``Ha llevado a cabo estudios sobre un problema común relacionado al riego de céspedes residenciales en California: el escurrimiento de agua"
\item ``Mucha del agua que se aplica a los céspedes termina directamente en las alcantarillas. No solo se trata de agua desperdiciada; hemos descubierto también que el agua de escurrimientos arrastra contaminantes (incluyendo pesticidas y fertilizantes) hasta las alcantarillas y, eventualmente, a los canales y vías fluviales. El problema radica en que los sistemas de aspersores típicos aplican agua de forma más rápida que la que la tierra puede absorber, lo cual lleva al escurrimiento"
\end{itemize}

\section{Información disponible}

Para los problemas anteriormente mencionados existe información que será utilizado para planificar y determinar un riego, los podemos ver a continuación:

\begin{itemize}
\item Pronóstico del tiempo: será utilizado para saber la probabilidad de lluvia en la zona en la que se encuentra el dispositivo.
\item Tipo de suelo: indica el tipo de suelo en el que el dispositivo será utilizado.
\item Humedad del suelo: indica la humedad del suelo utilizando sensores de humedad.
\end{itemize}

Existe más información que puede ser incluida para mejorar la calidad del riego aplicado al suelo, pero para en este trabajo solo se considera las variables antes mencionadas.

%contenido cuarto capitulo
\chapter{Desalloro}

En este capitulo se mostrarán los pasos necesarios para construir y hacer funcionar el dispositivo de riego. Primero veremos todo lo relacionado con el hardware juntado todas las partes, luego se trabajará en el desarrollo del modelo que corresponde a la parte de software del dispositivo. También se mostrará un algo breve del desarrollo de la aplicación web y finalmente veremos las variables necesarias para determinar un helada y como se hará para notificar a los usuarios.

\section{Hardware}

Raspberry es una plataforma muy útil para el desarrollo de aplicaciones domóticas y de control. Sin embargo. Raspberry tiene una limitación en cuanto a entradas/salidas disponibles y no puede trabajar con modulación por ancho de pulsos.

Una solución a este problema puede ser utilizar un Beaglebone black o se puede combinar el Raspberry con Arduino y dejar todo el control de hardware al Arduino y solo utilizar la Raspberry como controlador. En esta sección se mostrará como conectar la Raspberry con un Arduino a través de USB a través de comunicación serie.

\subsection{Arduino}

\subsubsection{Programación Arduino}

Lo primero que se hará es crear un programa para Arduino que leerá la información de uin sensor de humedad y la información que envía un sensor de flujo utilizando el puerto serie del Arduino. El programa que utilizamos se muestra a continuación, para ello se debe instalar el IDE de Arduino desde el siguiente enlace:

\url{https://www.arduino.cc/en/Main/Software}

Instalado el programa, conectar al Arduino a la computadora, ejecutar el programa y ya se esta listo para trabajar.

A continuación se mostrará el código con el cual se puede leer información desde distintos tipos de sensores.\\

Declaración de variables:\\

volatile int  frecuencia\_sensor;  \textit{// Mide los pulsos de flujo}

unsigned int  litrosHora;          \textit{// Calcula los litros por hora}  

unsigned int humedad\_sensor;        \textit{// Mide la humedad del suelo}

unsigned char pinFlujo = 2;  \textit{// Pin de flujo (Pin 2)}

unsigned char pinHumedad = A0;  \textit{// Pin de humedad (Pin A0)}

unsigned long tiempoActual;

unsigned long tiempoCiclo;\\

Función setup:\\

void setup()\{

	pinMode(pinFlujo, INPUT); \textit{// pinFlujo se declara como entrada}

	Serial.begin(9600); \textit{ // Permite la comunicación con la Raspberry}

	attachInterrupt(0, flujo, RISING); \textit{// Setup Interrupt }

	sei();                            \textit{// Enable interrupts } 

	tiempoActual = millis();

	tiempoCiclo = tiempoActual;

\}\\

Función loop:\\

void loop() \{

	humedad\_sensor = analogRead(pinHumedad);  \textit{// Entrada analógica}

	Serial.print(humedad\_sensor); \textit{// Envía el valor a la Raspberry}

	Serial.println(" Humedad"); \textit{// Parámetro opcional}

	tiempoActual = millis(); \textit{//Mide el tiempo actual}

	\textit{  //Cada segundo, calcula e imprime litros por hora}

	if(tiempoActual >= (tiempoCiclo + 1000))\{

		litrosHora = (frecuencia\_sensor * 60 / 7.5); \textit{// Formula litro por hora }

		frecuencia\_sensor = 0;                  \textit{ // Resetea el contador}

		Serial.print(litrosHora);            \textit{// Envío a Raspberry litro por hora}

		Serial.println(" L/hour");  		\textit{// Envío parámetro opcional}

	\}

\}\\


Una vez escrito el código en el IDE, se verifica y se sube al Arduino. Es importante destacar que para enviar información a las Raspberry se utiliza la linea de código Serial.println("mensaje").

\subsubsection{Conexión de sensores}

Los sensores que se utilizarán son de humedad e suelo y flujo de agua.


\subsection{Raspberry}

Para configurar la Raspberry lo primero que hay que hacer es instalar las librerías para el control del puerto serie desde Python. Para hacer esto ejecutamos el siguiente comando desde la consola en nuestra Raspberry:

\textit{sudo apt-get install python-serial}

Con esto instalado ya esta lista la Raspberry para comunicarse al Arduino utilizando el puerto serie. Lo hay que determinar es que puerto utiliza el Arduino cuando esta conectado al Raspberry. Para saber el puerto primero se conecta el Arduino a la Raspberry  por USB y luego se ejecuta el siguiente comando:

\textit{ls /dev/tty*}

Una vez ejecutado el comando se verá un listado de diferentes dispositivos. El Arduino en este caso aparece en el último lugar llamado /dev/ttyUSB0 como se ve el la Figura \ref{resultado}:

\begin{figure}[h]
\centering
\includegraphics[width=10cm]{USBArduino.png}
\caption{Arduino en Raspberry}
\label{resultado}
\end{figure}

Una vez que el Arduino esta identificado ya podemos comenzar a comunicarnos mediante un programa en Python. En este caso se mostrará un ejemplo de como recibir la información en la Raspberry enviada desde el Arduino, en la Figura \ref{raspardu} se puede ver el código utilizado.

\begin{figure}[h]
\centering
\includegraphics[width=10cm]{RaspberryArduino.png}
\caption{Comunicación Raspberry Arduino}
\label{raspardu}
\end{figure}


Con este programa en Python ya se puede recibir datos desde el Arduino en la Raspberry, para probarlo se ejecuta el programa con la siguiente linea de código \textit{sudo python nombre\_programa.py} y se pueden ver los resultados obtenido en la Figura \ref{raciboDatos}

\begin{figure}[h]
\centering
\includegraphics[width=10cm]{ReciboDatos.png}
\caption{Recibo de datos desde Arduino en Raspberry}
\label{raciboDatos}
\end{figure}



%% ambiente glosario
\begin{glosario}
  \item[El primer término:] Este es el significado del primer término, realmente no se bien lo que significa pero podría haberlo averiguado si hubiese tenido un poco mas de tiempo.
  \item[El segundo término:] Este si se lo que significa pero me da lata escribirlo...
\end{glosario}

%% ambiente glosario
\begin{glosario}
  \item[El primer término:] Este es el significado del primer término, realmente no se bien lo que significa pero podría haberlo averiguado si hubiese tenido un poco mas de tiempo.
  \item[El segundo término:] Este si se lo que significa pero me da lata escribirlo...
\end{glosario}


%% genera las referencias
\bibliography{refs}


%% comienzo de la parte de anexos
\appendixpart

%% contenido del primer anexo
\appendix{El Primer Anexo}
Aquí va el texto del primer anexo...

\section{La primera sección del primer anexo}
Aquí va el texto de la primera sección del primer anexo...

\section{La segunda sección del primer anexo}
Aquí va el texto de la segunda sección del primer anexo...

\subsection{La primera subsección de la segunda sección del primer anexo}


%% contenido del segundo anexo
\appendix{El segundo Anexo}
Aquí va el texto del segundo anexo...

\section{La primera sección del segundo anexo}
Aquí va el texto de la primera sección del segundo anexo...

%% fin
\end{document}

   

